<app-content-header [title]="'学生资产'" [menus]="contentHeader"></app-content-header>

<div class="content">
  <app-collapse-box [collapse]="false" [boxTitle]="'学生资产列表过滤'">
    <div class="col-xs-12 col-md-4 input-group-sm">
      <label class="pull-left">学生姓名:</label>
      <div class="input-group input-group-sm" style="width: 148px;">
        <input class="form-control" [(ngModel)]="filterStuName" placeholder="请输入学生名称">
        <div class="input-group-addon"><i class="fa fa-search"></i></div>
      </div>
    </div>
  </app-collapse-box>

  <div class="box box-primary box-divide">
    <div class="box-header">
      <h3 class="box-title">
        学生资产列表
      </h3>
    </div>
    <div class="box-body">
      <table class="table table-hover table-bordered text-center">
        <thead>
        <tr>
          <th>学生姓名</th>
          <th>缴费总额</th>
          <th>使用金额</th>
          <th>退费金额</th>
          <th>可退金额</th>
          <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let asset of assets | matchItem: filterStuName : 'studentName'">
          <td>{{ asset.studentName }}</td>
          <td>{{ asset.totalMoney }}</td>
          <td>{{ asset.usedMoney }}</td>
          <td>{{ asset.alreadyBackMoney }}</td>
          <td>{{ asset.canBackMoney }}</td>
          <td>
            <span *ngIf="(asset.inProgress)" class="text-muted">退费申请中</span>
            <div class="btn-group btn-group-xs" *ngIf="!asset.inProgress">
              <button class="btn btn-xs btn-danger"
                      [disabled]="!asset.canBackMoney"
                      (click)="curAsset = asset;withDrawEvent.returnAmount = '';
                        drawback.showModal({
                          modalSize: 'sm',
                          title: '申请退费',
                          type: 'default',
                          confirm: drawbackMoney
                        })">申请退费</button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<app-modal #drawback [disabledAcceptBtn]="!withDrawEvent.returnAmount || (withDrawEvent.returnAmount > (curAsset.hasPay - curAsset.hasUsed))">
  <div class="form-group clearfix">
    <label for="wantDrawbackMoney" class="control-label col-xs-3">退费金额:</label>
    <div class="col-xs-9">
      <div class="input-group input-group-sm">
        <input type="number"
               style="width: 100%;"
               id="wantDrawbackMoney"
               class="form-control {{ withDrawEvent.returnAmount > (curAsset.canBackMoney) && 'error' }}"
               [(ngModel)]="withDrawEvent.returnAmount"
               min="0"
               max="{{curAsset.canBackMoney}}"
               placeholder="最多可退金额{{ curAsset.canBackMoney }}">
        <span class="input-group-addon">元</span>
      </div>
    </div>
  </div>

  <div class="form-group clearfix">
    <label for="drawbackRemark" class="control-label col-xs-3">
      退费说明:
    </label>
    <div class="col-xs-9">
      <textarea name="drawbackRemark"
                style="width: 100%;"
                id="drawbackRemark"
                rows="3"
                class="form-control"
                placeholder="请输入退费说明"
                [(ngModel)]="withDrawEvent.remark"></textarea>
    </div>
  </div>
</app-modal>
